@startuml (id=core)
!include <tupadr3/common>
!include <tupadr3/font-awesome-5/cog>
!include <tupadr3/font-awesome-5/pen_square>
!include <tupadr3/font-awesome-5/user>
!include <tupadr3/font-awesome-5/user_alt>
!include <tupadr3/font-awesome-5/user_cog>
!include <tupadr3/font-awesome-5/user_edit>
!include <tupadr3/font-awesome-5/question>
!include <tupadr3/font-awesome-5/question_circle>
!include <tupadr3/font-awesome-5/puzzle_piece>
!include <tupadr3/font-awesome-5/fan>
!include <tupadr3/font-awesome-5/film>
!include <tupadr3/font-awesome-5/book>
!include <tupadr3/font-awesome-5/book_open>
!include <tupadr3/font-awesome-5/book_reader>
!include <tupadr3/font-awesome/gamepad>
!include <tupadr3/font-awesome-5/heartbeat>
!include <tupadr3/font-awesome/history>
!include <tupadr3/font-awesome-5/mask>
!include <tupadr3/font-awesome-5/pencil_ruler>
!include <tupadr3/font-awesome-5/file_alt>
!include <tupadr3/font-awesome-5/file_code>
!include <tupadr3/font-awesome-5/file_contract>
!include <tupadr3/font-awesome-5/file_image>
!include <tupadr3/material/extension>
!include <tupadr3/material/local_library>
!include <tupadr3/material/toys>
!include <tupadr3/material/description>
!include <tupadr3/material/videogame_asset>

!include i18n.puml!core

skinparam defaultTextAlignment center
' skinparam defaultFontName Ubuntu Mono
skinparam defaultFontName Nimbus Mono PS
skinparam defaultFontSize 15
scale max 800 width
' skinparam dpi 150

left to right direction

<style>
  rectangle {
    FontSize: 20;
  }
  collections {
    FontSize: 20;
  }
  card {
    FontSize: 20;
  }
  label {
    FontSize: 20;
  }
  .axis {
    FontSize: 20;
    FontName: Nimbus Mono PS;
    FontColor: DimGrey;
  }
  .plane {
    FontSize: 16;
  }
  .sth {
  }
  .nth {
    FontColor: Transparent;
  }
  .puzzler {
    FontSize: 40;
    FontStyle: bold;
  }
</style>

!procedure $empty_player()
  label player [
  ]
!endprocedure

!procedure $iconify_players($count=1)
  !if ($count==1)
    label player [
      <$user_alt{scale=0.9}>
    ]
  !else
    label player [
      <$user_alt{scale=0.45}>
      <$user_alt{scale=0.45}> <$user_alt{scale=0.45}>
    ]
  !endif
!endprocedure

!procedure $fill_players($count=1)
  !if ($count==1)
    label player [
      <$user_alt{scale=0.9}>
      $translate(player, $count)
    ]
  !else
    label player [
      <$user_alt{scale=0.45}>
      <$user_alt{scale=0.45}> <$user_alt{scale=0.45}>
      $translate(player, $count)
    ]
  !endif
!endprocedure

!procedure $empty_master()
  label characterAgent [
  ]
!endprocedure

!procedure $iconify_master()
  label characterAgent [
    ' <$user_edit{scale=0.9}>
    <$user_edit>
  ]
!endprocedure

!procedure $fill_character_agent($time="dev")
  label characterAgent <<agent>> [
    <$user_alt{scale=0.7}>
  !if ($time=="dev")
    $translate(characterWriter)
    ' ($translate(devtime))
  !elseif ($time=="run")
    $translate(characterController)
    ' ($translate(runtime))
  !else
    !assert %false() : "Unknown time"
  !endif
  ]
!endprocedure

!procedure $empty_engine()
  label avatarAgent [
  ]
!endprocedure

!procedure $iconify_engine()
  label avatarAgent [
    ' <$user_cog{scale=0.9}>
    <$user_cog>
  ]
!endprocedure

!procedure $fill_avatar_agent($time="dev")
  label avatarAgent <<agent>> [
    <$user_alt{scale=0.7}>
  !if ($time=="dev")
    $translate(avatarDesigner)
    ' ($translate(devtime))
  !elseif ($time=="run")
    $translate(avatarController)
    ' ($translate(runtime))
  !else
    !assert %false() : "Unknown time"
  !endif
  ]
!endprocedure

!procedure $empty_character()
  label character [
  ]
!endprocedure

!procedure $fill_characters($count=1)
  !if ($count==1)
    rectangle character [
      <$pen_square{scale=0.52}><size:7> </size>$translate(character, $count)
      ' <$book_reader{scale=0.52}><size:7> </size>$translate(character, $count)
    ]
  !else
    collections character [
      <$pen_square{scale=0.52}><size:7> </size>$translate(character, $count)
      ' <$book_reader{scale=0.52}><size:7> </size>$translate(character, $count)
    ]
  !endif
!endprocedure

!procedure $textify_characters($count=1)
  !if ($count==1)
    card character #back:transparent;line.dotted [
      $translate(character2, $count)
    ]
  !else
    collections character #back:transparent;line.dotted [
      $translate(character2, $count)
    ]
  !endif
!endprocedure

!procedure $empty_avatar()
  label avatar [
  ]
!endprocedure

!procedure $fill_avatars($count=1)
  !if ($count==1)
    rectangle avatar [
      <U+0000><$cog{scale=0.52}><size:7> </size>$translate(avatar, $count)<U+0000>
      ' <U+0000><$gamepad{scale=0.58}><size:7> </size>$translate(avatar, $count)<U+0000>
    ]
  !else
    collections avatar [
      <U+0000><$cog{scale=0.52}><size:7> </size>$translate(avatar, $count)<U+0000>
      ' <U+0000><$gamepad{scale=0.58}><size:7> </size>$translate(avatar, $count)<U+0000>
    ]
  !endif
!endprocedure

!procedure $textify_avatars($count=1)
  !if ($count==1)
    card "  $translate(avatar2, $count)  " as avatar #back:transparent;line.dotted
  !else
    collections " $translate(avatar2, $count) " as avatar #back:transparent;line.dotted
  !endif
!endprocedure

!procedure $fill_story_agent($time="run")
  label storyAgent <<agent>> [
    <$user_alt{scale=0.7}>
  !if ($time=="dev")
    $translate(storyWriter)
    ' ($translate(devtime))
  !elseif ($time=="run")
    $translate(storyTeller)
    ' ($translate(runtime))
  !else
    !assert %false() : "Unknown time"
  !endif
  ]
!endprocedure

!procedure $fill_narrative_agent($time="run")
  label narrativeAgent <<agent>> [
    <$user_alt{scale=0.7}>
  !if ($time=="dev")
    $translate(narrativeDesigner)
    ' ($translate(devtime))
  !elseif ($time=="run")
    $translate(narrativePerformer)
    ' ($translate(runtime))
  !else
    !assert %false() : "Unknown time"
  !endif
  ]
!endprocedure

!procedure $fill_stories($count=1)
  !if ($count==1)
    rectangle story [
      ' <U+0000><U+0000><$history{scale=0.52}><size:7> </size>$translate(story, $count)<U+0000><U+0000>
      <U+0000><U+0000><$book_open{scale=0.50}><size:7> </size>$translate(story, $count)<U+0000><U+0000>
      ' <U+0000><U+0000><$film{scale=0.52}><size:7> </size>$translate(story, $count)<U+0000><U+0000>
    ]
  !else
    collections story [
      ' <U+0000><U+0000><$history{scale=0.52}><size:7> </size>$translate(story, $count)<U+0000><U+0000>
      <U+0000><U+0000><$book_open{scale=0.50}><size:7> </size>$translate(story, $count)<U+0000><U+0000>
      ' <U+0000><U+0000><$film{scale=0.52}><size:7> </size>$translate(story, $count)<U+0000><U+0000>
    ]
  !endif
!endprocedure

!procedure $fill_narratives($count=1)
  !if ($count==1)
    rectangle narrative [
      <$extension{scale=0.52}><size:7> </size>$translate(narrative, $count)
    ]
  !else
    collections narrative [
      <$extension{scale=0.52}><size:7> </size>$translate(narrative, $count)
    ]
  !endif
!endprocedure

!procedure $puzzle_agent($id)
  label $id <<puzzler>> [
     ?
  ]
!endprocedure

!procedure $draft_protocol($id)
  rectangle $id #line.dashed;back:transparent [
    <U+0000><U+0000><U+0000><U+0000><U+0000><U+0000><U+0000><U+0000><U+0000>
  ]
!endprocedure

!procedure $fill_axes()
  $fill_axis_x()
  $fill_axis_y()
!endprocedure

!procedure $fill_axis_x($style=axis)
  label character <<$style>> [
    $translate(gamelang)
  ]
  label avatar <<$style>> [
    $translate(gameplay)
  ]
  ' label leftmost <<axis>> [
  '   $translate(intention)
  ' ]
  ' label rightmost <<axis>> [
  '   $translate(action)
  ' ]
!endprocedure

!procedure $fill_axis_y($style=axis)
  label story <<$style>> [
    $translate(gameloop)
  ]
  label narrative <<$style>> [
    $translate(gamefeel)
  ]
  ' label highest <<axis>> [
  '   $translate(impl)
  ' ]
  ' label lowest <<axis>> [
  '   $translate(spec)
  ' ]
!endprocedure

!procedure $empty_axes()
  $empty_axis_x()
  $empty_axis_y()
!endprocedure

!procedure $empty_axis_x()
  label leftmost <<axis>> [
  ]
  label rightmost <<axis>> [
  ]
!endprocedure

!procedure $empty_axis_y()
  label highest <<axis>> [
  ]
  label lowest <<axis>> [
  ]
!endprocedure

!procedure $empty_axes_3x3()
  $empty_axis_x()
  $empty_axis_y()
  $empty_character()
  $empty_avatar()
  label story [
  ]
  label narrative [
  ]
!endprocedure

!procedure $join_axis_x($mode="thickness=1")
  leftmost ~[$mode]d~ player
  player ~[$mode]d~ rightmost
!endprocedure

!procedure $join_axis_y($mode="thickness=1")
  highest ~[$mode]r~ player
  player ~[$mode]r~ lowest
!endprocedure

!procedure $join_axes_1x1($x="thickness=1", $y="thickness=1")
  $join_axis_x($x)
  $join_axis_y($y)
!endprocedure

!procedure $join_axes_3x1($mode="thickness=1")
  leftmost ~[$mode]d~ character
  $join_grid_3x1($mode)
  avatar ~[$mode]d~ rightmost
!endprocedure

!procedure $join_axes_1x3($mode="thickness=1")
  highest ~[$mode]r~ story
  $join_grid_1x3($mode)
  narrative ~[$mode]r~ lowest
!endprocedure

!procedure $join_axes_3x3($x="thickness=1", $y="thickness=1")
  $join_axes_3x1($x)
  $join_axes_1x3($y)
!endprocedure

!procedure $join_axes_5x1($x="thickness=1", $y="thickness=1")
  ' leftmost ~[$x]d~ characterAgent
  $join_grid_5x1($x)
  ' avatarAgent ~[$x]d~ rightmost
!endprocedure

!procedure $join_axes_1x5($x="thickness=1", $y="thickness=1")
  ' highest ~[$x]r~ storyAgent
  $join_grid_1x5($x)
  ' narrativeAgent ~[$x]r~ lowest
!endprocedure

!procedure $join_axes_5x3($x="thickness=1", $y="thickness=1")
  $join_axes_5x1($x)
  $join_axes_1x3($y)
!endprocedure

!procedure $join_axes_5x5($x="thickness=1", $y="thickness=1")
  $join_axes_5x1($x)
  $join_axes_1x5($y)
!endprocedure

!procedure $fill_arcs($count=1)
  label "  $translate(arc, $count)  " as arcs <<matrix>>
!endprocedure

!procedure $fill_themes($count=1)
  label "  $translate(theme, $count)  " as themes <<matrix>>
!endprocedure

!procedure $fill_mechanics($count=1)
  label "$translate(mechanic, $count)" as mechanics <<matrix>>
!endprocedure

!procedure $fill_settings($count=1)
  label "$translate(setting, $count)" as settings <<matrix>>
!endprocedure

!procedure $fill_matrix($count=2)
  $fill_arcs($count)
  $fill_themes($count)
  $fill_settings($count)
  $fill_mechanics($count)
!endprocedure

!procedure $guess_matrix()
  $puzzle_agent(arcs)
  $puzzle_agent(mechanics)
  $puzzle_agent(settings)
  $puzzle_agent(themes)
!endprocedure

!procedure $join_matrix_3x1()
  arcs -[hidden]r- character
  character -[hidden]r- themes
  mechanics -[hidden]r- avatar
  avatar -[hidden]r- settings
!endprocedure

!procedure $join_matrix_3x3()
  arcs -[hidden]d- story
  story -[hidden]d- mechanics
  themes -[hidden]d- narrative
  narrative -[hidden]d- settings
!endprocedure

!procedure $empty_grid_1x3()
  label story [
  ]
  $fill_players()
  label narrative [
  ]
!endprocedure

!procedure $empty_grid_3x1()
  $empty_character()
  $fill_players()
  $empty_avatar()
!endprocedure

!procedure $empty_grid_3x3()
  $empty_character()
  $empty_avatar()

  label story [
  ]
  label narrative [
  ]
!endprocedure

!procedure $fill_grid_3x1($count=1)
  $fill_characters($count)
  $fill_players($count)
  $fill_avatars($count)
!endprocedure

!procedure $fill_grid_1x3($count=1)
  $fill_stories($count)
  $fill_narratives($count)
!endprocedure

!procedure $fill_grid_3x3($count=1)
  $fill_grid_3x1($count)
  $fill_grid_1x3($count)
!endprocedure

!procedure $iconify_grid_3x1($count=1)
  $fill_characters($count)
  $iconify_players($count)
  $fill_avatars($count)
!endprocedure

!procedure $iconify_grid_5x1($count=1)
  $iconify_master()
  $iconify_grid_3x1($count)
  $iconify_engine()
!endprocedure

!procedure $fill_grid_5x1($count=1)
  $fill_character_agent()
  $fill_grid_3x1($count)
  $fill_avatar_agent()
!endprocedure

!procedure $fill_grid_5x5($count=1, $time="dev")
  $fill_character_agent($time)
  $fill_avatar_agent($time)
  $fill_grid_3x1($count)
  $fill_grid_1x3($count)
  $fill_story_agent($time)
  $fill_narrative_agent($time)
!endprocedure

!procedure $join_grid_1x3($mode="thickness=1")
  story ~[$mode]r~ player
  player ~[$mode]r~ narrative
!endprocedure

!procedure $join_grid_3x1($mode="thickness=1")
  character ~[$mode]d~ player
  player ~[$mode]d~ avatar
!endprocedure

!procedure $join_grid_3x3($mode="thickness=1")
  $join_grid_3x1($mode)
  $join_grid_1x3($mode)
!endprocedure

!procedure $join_grid_5x1($mode="thickness=1")
  characterAgent ~[$mode]d~ character
  $join_grid_3x1($mode)
  avatar ~[$mode]d~ avatarAgent
!endprocedure

!procedure $join_grid_1x5($mode="thickness=1")
  storyAgent ~[$mode]r~ story
  $join_grid_1x3($mode)
  narrative ~[$mode]r~ narrativeAgent
!endprocedure

!procedure $join_grid_5x3($mode="thickness=1")
  $join_grid_5x1($mode)
  $join_grid_1x3($mode)
!endprocedure

!procedure $join_grid_5x5($mode="thickness=1")
  $join_grid_5x1($mode)
  $join_grid_1x5($mode)
!endprocedure

!procedure $loop_character($mode="thickness=1")
  character -[plain]d-> player
  character ~[$mode]d~ player
  character <-[plain]d- player
!endprocedure

!procedure $loop_avatar($mode="thickness=1")
  player <-[plain]d- avatar
  player ~[$mode]d~ avatar
  player -[plain]d-> avatar
!endprocedure

!procedure $loop_master($mode="thickness=1")
  characterAgent <-[plain]d- character
  characterAgent ~[$mode]d~ character
  characterAgent -[plain]d-> character
!endprocedure

!procedure $loop_engine($mode="thickness=1")
  avatar -[plain]d-> avatarAgent
  avatar ~[$mode]d~ avatarAgent
  avatar <-[plain]d- avatarAgent
!endprocedure

!procedure $loop_story($mode="thickness=1")
  $loop_master($mode)
  $loop_character($mode)
!endprocedure

!procedure $loop_gameplay($mode="thickness=1")
  $loop_avatar($mode)
  $loop_engine($mode)
!endprocedure

!$debug = %false()
!if ($debug)
  rectangle n1 [
    <$local_library{scale=0.55}><size:7> </size>narrative
  ]
  rectangle p1 [
    <U+0000><U+0000><$local_library{scale=0.55}><size:7> </size>story<U+0000><U+0000>
  ]
  rectangle n2 [
    <$cog{scale=0.52}><size:7> </size>narrative
  ]
  rectangle p2 [
    <U+0000><U+0000><$cog{scale=0.52}><size:7> </size>story<U+0000><U+0000>
  ]
  rectangle n3 [
    <$pen_square{scale=0.53}><size:7> </size>narrative
  ]
  rectangle p3 [
    <U+0000><U+0000><$pen_square{scale=0.53}><size:7> </size>story<U+0000><U+0000>
  ]
  ' rectangle n4 [
  '   <$file_alt{scale=0.53}><size:7> </size>narrative
  ' ]
  ' rectangle p4 [
  '   <U+0000><U+0000><$file_alt{scale=0.53}><size:7> </size>story<U+0000><U+0000>
  ' ]
  rectangle n5 [
    <$extension{scale=0.53}><size:7> </size>narrative
  ]
  rectangle p5 [
    <U+0000><U+0000><$extension{scale=0.53}><size:7> </size>story<U+0000><U+0000>
  ]
  ' rectangle n6 [
  '   <$description{scale=0.53}><size:7> </size>narrative
  ' ]
  ' rectangle p6 [
  '   <U+0000><U+0000><$description{scale=0.53}><size:7> </size>story<U+0000><U+0000>
  ' ]
!endif
@enduml
