@startuml (id=core)
!include <tupadr3/common>
!include <tupadr3/font-awesome-5/cog>
!include <tupadr3/font-awesome-5/pen_square>
!include <tupadr3/font-awesome-5/user_alt>
!include <tupadr3/font-awesome-5/user_cog>
!include <tupadr3/font-awesome-5/user_edit>
!include <tupadr3/font-awesome-5/question>
!include <tupadr3/font-awesome-5/question_circle>
!include <tupadr3/font-awesome-5/puzzle_piece>

skinparam defaultTextAlignment center
skinparam defaultFontName Ubuntu Mono
skinparam defaultFontSize 15
scale max 600 width

left to right direction

<style>
  rectangle {
    FontSize: 22;
  }
  collections {
    FontSize: 22;
  }
  label {
    FontSize: 16;
  }
  .axis {
    FontSize: 12;
    FontColor: DimGrey;
  }
  .plane {
    FontSize: 16;
    Padding: 0;
    Margin: 0;
  }
  .sth {
  }
  .nth {
    FontColor: Transparent;
  }
  .puzzler {
    FontSize: 40;
    FontStyle: bold;
  }
</style>


!procedure $fill_origin()
  label player [
    <$user_alt{scale=0.9}>
  ]
!endprocedure

!procedure $fill_player($mode="sp")
  !if ($mode=="sp")
    label player [
      <$user_alt{scale=0.9}>
      игрок
    ]
  !else
    label player [
      <$user_alt{scale=0.5}>
      <$user_alt{scale=0.5}> <$user_alt{scale=0.5}>
      игроки
    ]
  !endif
!endprocedure

!procedure $empty_master()
  label master [
  ]
!endprocedure

!procedure $fill_master()
  label master [
    <$user_edit{scale=0.9}>
    мастер
  ]
!endprocedure

!procedure $empty_engine()
  label engine [
  ]
!endprocedure

!procedure $fill_engine()
  label engine [
    <$user_cog{scale=0.9}>
    движок
  ]
!endprocedure

!procedure $empty_character()
  label character [
  ]
!endprocedure

!procedure $fill_character($mode="sp")
  !if ($mode=="sp")
    rectangle character [
      <$pen_square{scale=0.4}><size:8> </size>персонаж
    ]
  !else
    collections character [
      <$pen_square{scale=0.4}><size:8> </size>персонажи
    ]
  !endif
!endprocedure

!procedure $empty_avatar()
  label avatar [
  ]
!endprocedure

!procedure $fill_avatar($mode="sp")
  !if ($mode=="sp")
    rectangle avatar [
      <U+0000><$cog{scale=0.4}><size:8> </size>аватар<U+0000>
    ]
  !else
    collections avatar [
      <U+0000><$cog{scale=0.4}><size:8> </size>аватары<U+0000>
    ]
  !endif
!endprocedure

!procedure $puzzle_agent($id)
  label $id <<puzzler>> [
     ?
  ]
!endprocedure

!procedure $draft_protocol($id)
  rectangle $id #line.dashed;back:transparent [
    <U+0000><U+0000><U+0000><U+0000><U+0000><U+0000><U+0000><U+0000><U+0000>
  ]
!endprocedure

!procedure $fill_legend()
  $fill_legend_x()
  $fill_legend_y()
!endprocedure

!procedure $fill_legend_x($style=axis)
  label leftmost <<$style>> [
    к
    у
    л
    с
    т
    о
    р
    и
  ]
  label rightmost <<$style>> [
    г
    е
    й
    м
    п
    л
    е
    й
  ]
!endprocedure

!procedure $fill_legend_y($style=axis)
  label highest <<$style>> [
    р а ц и о
  ]
  label lowest <<$style>> [
    э м о ц и о
  ]
!endprocedure

!procedure $empty_legend()
  $empty_legend_x()
  $empty_legend_y()
!endprocedure

!procedure $empty_legend_x()
  label leftmost <<axis>> [
  ]
  label rightmost <<axis>> [
  ]
!endprocedure

!procedure $empty_legend_y()
  label highest <<axis>> [
  ]
  label lowest <<axis>> [
  ]
!endprocedure

!procedure $join_legend_x($x="thickness=1")
  leftmost ~[$x]d~ master
  engine ~[$x]d~ rightmost
!endprocedure

!procedure $join_legend_y($y="thickness=1")
  highest ~[$y]r~ player
  player ~[$y]r~ lowest
!endprocedure

!procedure $join_legend_1x1($x="thickness=1", $y="thickness=1")
  leftmost ~[$x]d~ player
  player ~[$x]d~ rightmost
  highest ~[$y]r~ player
  player ~[$y]r~ lowest
!endprocedure

!procedure $join_legend_3x1($x="thickness=1", $y="thickness=1")
  leftmost ~[$x]d~ character
  avatar ~[$x]d~ rightmost
  highest ~[$y]r~ player
  player ~[$y]r~ lowest
!endprocedure

!procedure $join_legend_3x3($x="thickness=1", $y="thickness=1")
  leftmost ~[$x]d~ character
  avatar ~[$x]d~ rightmost
  highest ~[$y]r~ upper
  lower ~[$y]r~ lowest
!endprocedure

!procedure $join_legend_5x1($x="thickness=1", $y="thickness=1")
  leftmost ~[$x]d~ master
  engine ~[$x]d~ rightmost
  highest ~[$y]r~ player
  player ~[$y]r~ lowest
!endprocedure

!procedure $join_legend_5x3($x="thickness=1", $y="thickness=1")
  leftmost ~[$x]d~ master
  engine ~[$x]d~ rightmost
  highest ~[$y]r~ upper
  lower ~[$y]r~ lowest
!endprocedure

!procedure $fill_arcs()
  label arcs [
    ""  арка  ""
  ]
!endprocedure

!procedure $fill_themes()
  label themes [
    ""  тема  ""
  ]
!endprocedure

!procedure $fill_mechanics()
  label mechanics [
    ""механика""
  ]
!endprocedure

!procedure $fill_settings()
  label settings [
    ""сеттинг""
  ]
!endprocedure

!procedure $fill_matrix()
  $fill_arcs()
  $fill_themes()
  $fill_settings()
  $fill_mechanics()
!endprocedure

!procedure $guess_matrix()
  $puzzle_agent(arcs)
  $puzzle_agent(mechanics)
  $puzzle_agent(settings)
  $puzzle_agent(themes)
!endprocedure

!procedure $join_matrix_3x1()
  arcs -[hidden]r- character
  character -[hidden]r- themes
  mechanics -[hidden]r- avatar
  avatar -[hidden]r- settings
!endprocedure

!procedure $join_matrix_3x3()
  arcs -[hidden]d- upper
  upper -[hidden]d- mechanics
  themes -[hidden]d- lower
  lower -[hidden]d- settings
!endprocedure

!procedure $empty_grid_1x3()
  label upper [
  ]
  $fill_player()
  label lower [
  ]
!endprocedure

!procedure $empty_grid_3x1()
  $empty_character()
  $fill_player()
  $empty_avatar()
!endprocedure

!procedure $empty_grid_3x3()
  $empty_character()
  $empty_avatar()

  label upper [
  ]
  label lower [
  ]
!endprocedure

!procedure $fill_grid_3x1($mode="sp")
  $fill_character($mode)
  $fill_player($mode)
  $fill_avatar($mode)
!endprocedure

!procedure $fill_grid_5x1($mode="sp")
  $fill_master()
  $fill_grid_3x1($mode)
  $fill_engine()
!endprocedure

!procedure $fill_narrative($mode="sp")
  $fill_master()
  $fill_character($mode)
  $fill_player($mode)
!endprocedure

!procedure $fill_gameplay($mode="sp")
  $fill_player($mode)
  $fill_avatar($mode)
  $fill_engine()
!endprocedure

!procedure $join_grid_1x3($mode="thickness=1")
  upper ~[$mode]r~ player
  player ~[$mode]r~ lower
!endprocedure

!procedure $join_grid_3x1($mode="thickness=1")
  character ~[$mode]d~ player
  player ~[$mode]d~ avatar
!endprocedure

!procedure $join_grid_5x1($mode="thickness=1")
  $join_narrative_5x1($mode)
  $join_gameplay_5x1($mode)
!endprocedure

!procedure $join_grid_3x3($mode="thickness=1")
  $join_grid_3x1($mode)
  $join_grid_1x3($mode)
!endprocedure

!procedure $join_grid_5x3($mode="thickness=1")
  $join_grid_5x1($mode)
  $join_grid_1x3($mode)
!endprocedure

!procedure $join_narrative_5x1($mode="thickness=1")
  master ~[$mode]d~ character
  character ~[$mode]d~ player
!endprocedure

!procedure $join_gameplay_5x1($mode="thickness=1")
  player ~[$mode]d~ avatar
  avatar ~[$mode]d~ engine
!endprocedure

!procedure $join_protocol_5x1($mode="thickness=1")
  master ~[$mode]d~ character
  avatar ~[$mode]d~ engine
!endprocedure

!procedure $loop_character($mode="thickness=1")
  character -[plain]d-> player
  character ~[$mode]d~ player
  character <-[plain]d- player
!endprocedure

!procedure $loop_avatar($mode="thickness=1")
  player <-[plain]d- avatar
  player ~[$mode]d~ avatar
  player -[plain]d-> avatar
!endprocedure

!procedure $loop_master($mode="thickness=1")
  master <-[plain]d- character
  master ~[$mode]d~ character
  master -[plain]d-> character
!endprocedure

!procedure $loop_engine($mode="thickness=1")
  avatar -[plain]d-> engine
  avatar ~[$mode]d~ engine
  avatar <-[plain]d- engine
!endprocedure

!procedure $loop_story($mode="thickness=1")
  $loop_master($mode)
  $loop_character($mode)
!endprocedure

!procedure $loop_gameplay($mode="thickness=1")
  $loop_avatar($mode)
  $loop_engine($mode)
!endprocedure

!$debug = %false()
!if ($debug)
  $fill_player()
!endif
@enduml
